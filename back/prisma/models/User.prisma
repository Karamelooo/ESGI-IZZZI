model User {
  id                   Int     @id @default(autoincrement())
  firstName            String
  lastName             String
  email                String  @unique
  password             String
  refreshToken         String?
  refreshTokenVersion  Int     @default(0)
  authorizationVersion Int     @default(0)
  institutionId        Int

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  institution Institution @relation(fields: [institutionId], references: [id])
  userRoles   UserRole[]
  subscriptions Subscription[]

  @@index([email])
  @@index([institutionId])
}

model Role {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  description String?
  system      Boolean @default(false)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  rolePermissions RolePermission[]
  userRoles       UserRole[]
}

model Permission {
  id  Int    @id @default(autoincrement())
  key String @unique

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  rolePermissions RolePermission[]
}

model RolePermission {
  roleId       Int
  permissionId Int

  createdAt DateTime @default(now())

  role       Role       @relation(fields: [roleId], references: [id])
  permission Permission @relation(fields: [permissionId], references: [id])

  @@id([roleId, permissionId])
  @@index([permissionId])
}

model UserRole {
  userId Int
  roleId Int

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
  @@index([roleId])
}
